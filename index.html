<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puer Aeternus Bingo</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ­</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-top: 80px;
        }

        h1 {
            color: white;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
        }

        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: flex;
            flex-direction: column;
            gap: 10px;
            min-width: 150px;
        }

        .controls h3 {
            margin: 0;
            font-size: 14px;
            color: #2c3e50;
            text-align: center;
        }

        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        .control-btn {
            background: #3498db;
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        .control-btn:active {
            transform: scale(0.95);
        }

        .item-count {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            min-width: 40px;
            text-align: center;
        }

        .shuffle-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .shuffle-btn:hover {
            background: #229954;
            transform: translateY(-1px);
        }

        .shuffle-btn:active {
            transform: translateY(0);
        }

        .bingo-container {
            display: grid;
            gap: 10px;
            max-width: 800px;
            min-width: 0;
            width: 100%;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            overflow: hidden;
            position: relative;
        }

        .bingo-tile {
            aspect-ratio: 1;
            background: white;
            border: 3px solid #3498db;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            user-select: none;
            position: relative;
            min-width: 0;
            min-height: 0;
            overflow: hidden;
            word-wrap: break-word;
        }

        .bingo-tile.placeholder {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-color: #bdc3c7;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .bingo-tile:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .bingo-tile.marked {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border-color: #229954;
        }

        .bingo-tile.marked::before {
            content: '';
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bingo-tile.marked::after {
            content: 'âœ“';
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 16px;
            color: white;
            font-weight: bold;
        }

        .reset-btn {
            margin-top: 20px;
            padding: 12px 30px;
            background: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .error-message {
            color: #e74c3c;
            background: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 600px;
            text-align: center;
        }

        @media (max-width: 600px) {
            .bingo-tile {
                font-size: 11px;
                padding: 5px;
            }

            .bingo-container {
                gap: 5px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="controls">
        <h3>Items to Use</h3>
        <div class="control-row">
            <button class="control-btn" onclick="decreaseItems()">-</button>
            <span class="item-count" id="itemCount">25</span>
            <button class="control-btn" onclick="increaseItems()">+</button>
        </div>
        <button class="shuffle-btn" onclick="shuffleBoard()">ðŸ”€ Shuffle</button>
    </div>
    
    <h1>ðŸŽ­ Puer Aeternus Bingo</h1>
    <div class="bingo-container" id="bingoBoard"></div>

    <script>
        // ===== EDIT ITEMS HERE FOR TESTING =====
        // Just add or remove items from this list to test different board sizes
        const DEFAULT_ITEMS = `Free Space
Coffee Break
Meeting Runs Late
Technical Difficulties
Someone's On Mute
Can You See My Screen?
Sorry, Go Ahead
Email Could've Been
Let's Circle Back
Moving Forward
Synergy
Low Hanging Fruit
Think Outside Box
Touch Base
On My Radar
Bandwidth
Deep Dive
Loop You In
Take This Offline
Action Items
Best Practices
Leverage
Paradigm Shift
Win-Win
Game Changer
At The End Of Day
Reach Out
Ping Me
Circle Back Around
Let's Take This Async
Parking Lot
Quick Sync
Align On This
Get Ducks In Row
Run It Up Flagpole
Boil The Ocean
Move The Needle
Drink The Kool-Aid
Peel The Onion
Push The Envelope`.split('\n').map(item => item.trim());

        // Global variables for controlling items
        let currentItemCount = 25;
        let availableItems = [];
        let rebuildTimeout = null;
        let isBuilding = false;

        function increaseItems() {
            if (currentItemCount < availableItems.length) {
                currentItemCount++;
                document.getElementById('itemCount').textContent = currentItemCount;
                debouncedRefresh();
            }
        }

        function decreaseItems() {
            if (currentItemCount > 1) {
                currentItemCount--;
                document.getElementById('itemCount').textContent = currentItemCount;
                debouncedRefresh();
            }
        }

        function shuffleBoard() {
            refreshBoard();
        }

        function debouncedRefresh() {
            // Cancel any pending rebuild
            if (rebuildTimeout) {
                clearTimeout(rebuildTimeout);
            }
            
            // Schedule a new rebuild
            rebuildTimeout = setTimeout(() => {
                refreshBoard();
            }, 100);
        }

        function refreshBoard() {
            // Don't start a new build if one is already happening
            if (isBuilding) return;
            
            isBuilding = true;
            const board = document.getElementById('bingoBoard');
            
            // Render placeholders with proper sizing FIRST
            renderPlaceholders();
            
            // Then swap in the real content after a tiny delay
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    populateBoard();
                });
            });
        }

        function renderPlaceholders() {
            const board = document.getElementById('bingoBoard');
            
            // Calculate grid size
            const targetSize = getNextSquare(currentItemCount);
            const gridSize = Math.sqrt(targetSize);
            
            // Set grid dimensions
            board.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
            
            // Clear and create placeholders
            board.innerHTML = '';
            for (let i = 0; i < targetSize; i++) {
                const tile = document.createElement('div');
                tile.className = 'bingo-tile placeholder';
                board.appendChild(tile);
            }
        }
        
        async function populateBoard() {
            const board = document.getElementById('bingoBoard');
            
            // Load items
            let source = 'default items';
            try {
                const response = await fetch('items.txt');
                if (response.ok) {
                    const text = await response.text();
                    const fileItems = text.split('\n')
                        .map(line => line.trim())
                        .filter(line => line.length > 0);
                    
                    if (fileItems.length > 0) {
                        availableItems = fileItems;
                        source = 'items.txt';
                    } else {
                        availableItems = [...DEFAULT_ITEMS];
                    }
                } else {
                    availableItems = [...DEFAULT_ITEMS];
                }
            } catch (error) {
                availableItems = [...DEFAULT_ITEMS];
            }
            
            // Update count if needed
            if (currentItemCount > availableItems.length) {
                currentItemCount = availableItems.length;
            }
            document.getElementById('itemCount').textContent = currentItemCount;
            
            // Get items to use
            const allItems = availableItems.slice(0, currentItemCount);
            console.log(`Loading ${allItems.length} items from ${source} (${availableItems.length} available)`);
            
            const targetSize = getNextSquare(allItems.length);
            const gridSize = Math.sqrt(targetSize);
            console.log(`Creating ${gridSize}x${gridSize} board (${targetSize} tiles total)`);
            
            // Pad with empties
            const items = [...allItems];
            while (items.length < targetSize) {
                items.push('');
            }
            
            // Shuffle
            const shuffled = shuffle(items);
            
            // Replace placeholders with real tiles
            const tiles = board.querySelectorAll('.bingo-tile');
            shuffled.forEach((item, index) => {
                if (tiles[index]) {
                    const tile = tiles[index];
                    tile.className = 'bingo-tile';
                    tile.textContent = item;
                    
                    if (item) {
                        tile.onclick = function() {
                            this.classList.toggle('marked');
                        };
                    } else {
                        tile.style.opacity = '0.3';
                        tile.style.cursor = 'default';
                        tile.style.border = '3px dashed #95a5a6';
                        tile.onclick = null;
                    }
                }
            });
            
            isBuilding = false;
        }

        // Fisher-Yates shuffle
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // Find next larger perfect square (ceiling)
        function getNextSquare(num) {
            const sqrt = Math.ceil(Math.sqrt(num));
            return sqrt * sqrt;
        }

        // Initialize board from text file or fallback
        async function initBoard() {
            // First render placeholders so we have SOMETHING on screen
            renderPlaceholders();
            // Then populate with real content
            await populateBoard();
        }

        // Load board on page load
        initBoard();
    </script>
</body>
</html>
